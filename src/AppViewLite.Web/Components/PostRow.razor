
@code {
    [Parameter]
    public required BlueskyPost Post { get; set; }

    [Parameter]
    public bool IsQuote { get; set; }

    [Parameter]
    public bool ShowInReplyTo { get; set; } = true;

    [Parameter]
    public bool IsLastOfGroup { get; set; }

    [Parameter]
    public bool ShowRestOfThreadLink { get; set; }

    [Parameter]
    public bool IsFocalPost { get; set; }

    [Parameter]
    public bool ShowThreadLine { get; set; }

}




<li class="post @(IsFocalPost ? "post-focal" : null) @(IsLastOfGroup ? "post-last-of-group" : null)" @key="@(Post.RKey + "/" + Post.Did)">
    <a href="@Post.BaseUrl" class="post-background-link"></a>

    @if (ShowRestOfThreadLink)
    {
        <div class="post-thread-continuation-line"></div>
        <a class="post-rest-of-thread post-indented blue-link" href="@Post.BaseUrl">View full thread</a>
    }

    @if (ShowThreadLine && !IsLastOfGroup)
    {
        <div class="post-thread-line"></div>
    }


    @if (Post.RepostedBy != null)
    {
        <div class="post-reposted-by post-indented">
            <svg class="post-reposted-by-icon" fill="none" width="13" height="13" viewBox="0 0 24 24" style="color: rgb(66, 87, 108); margin-right: 3px;"><path fill="hsl(211, 24%, 34.2%)" fill-rule="evenodd" clip-rule="evenodd" d="M17.957 2.293a1 1 0 1 0-1.414 1.414L17.836 5H6a3 3 0 0 0-3 3v3a1 1 0 1 0 2 0V8a1 1 0 0 1 1-1h11.836l-1.293 1.293a1 1 0 0 0 1.414 1.414l2.47-2.47a1.75 1.75 0 0 0 0-2.474l-2.47-2.47ZM20 12a1 1 0 0 1 1 1v3a3 3 0 0 1-3 3H6.164l1.293 1.293a1 1 0 1 1-1.414 1.414l-2.47-2.47a1.75 1.75 0 0 1 0-2.474l2.47-2.47a1 1 0 0 1 1.414 1.414L6.164 17H18a1 1 0 0 0 1-1v-3a1 1 0 0 1 1-1Z"></path></svg>
            Reposted by <InlineProfileLink Profile="@Post.RepostedBy" />
        </div>
    }


    <a href="@Post.Author.BaseUrl" class="post-author-image-link">
        <img src="@Post.Author.AvatarUrl" class="post-author-image">
    </a>

    <div class="post-meta post-indented">
        <a class="post-author underline-on-hover" href="@Post.Author.BaseUrl">
            @Post.Author.DisplayNameOrFallback
        </a> ¬∑
        <a class="post-date" href="@Post.BaseUrl" title="@Program.ToFullHumanDate(Post.Date)">@Program.ToHumanDate(Post.Date)</a>
    </div>


    @if (ShowInReplyTo && Post.InReplyToUser != null)
    {
        <div class="post-in-reply-to post-indented">
            <svg class="post-in-reply-to-icon" viewBox="0 0 512 512" height="9" width="9" tabindex="-1" style="margin-right: 5px;"><path fill="hsl(211, 24%, 34.2%)" d="M205 34.8c11.5 5.1 19 16.6 19 29.2v64H336c97.2 0 176 78.8 176 176c0 113.3-81.5 163.9-100.2 174.1c-2.5 1.4-5.3 1.9-8.1 1.9c-10.9 0-19.7-8.9-19.7-19.7c0-7.5 4.3-14.4 9.8-19.5c9.4-8.8 22.2-26.4 22.2-56.7c0-53-43-96-96-96H224v64c0 12.6-7.4 24.1-19 29.2s-25 3-34.4-5.4l-160-144C3.9 225.7 0 217.1 0 208s3.9-17.7 10.6-23.8l160-144c9.4-8.5 22.9-10.6 34.4-5.4z"></path></svg>
            <span>
                Replying to <InlineProfileLink Profile="@Post.InReplyToUser" />
            </span>
        </div>
    }

    @if (Post.Data == null || Post.Data.Error != null)
    {

        <div class="post-error post-indented">[@(Post.Data?.Error ?? "Reached post retrieval limit for page load, consider refreshing")]</div>
    }
    <div class="post-body post-indented">

        <a href="@Post.BaseUrl" class="post-body-link-to-thread">
            <TextWithFacets Text="@(Post.Data?.Text)" Facets="@Post.Data?.Facets" />
        </a>


    </div>

    @if (Post.Data?.EmbedRecordUri != null)
    {
        <div class="post-link-list post-indented">@Post.Data.EmbedRecordUri</div>

    }
    @if (Post.Data?.ExternalUrl != null)
    {
        <a class="post-external-preview post-indented" target="_blank" rel="noreferrer" href="@Post.Data.ExternalUrl">
            @if (Post.Data.ExternalThumbCid != null)
            {
                <img class="post-external-preview-image" src="@Program.GetImageThumbnailUrl(Post.Did, Post.Data.ExternalThumbCid)" />
            }
            <div class="post-external-preview-metadata">
                <h2 class="post-external-preview-title">@Post.Data.ExternalTitle</h2>
                <div class="post-external-preview-summary">@Post.Data.ExternalDescription</div>
                <div class="post-external-preview-domain">
                    <svg fill="none" viewBox="0 0 24 24" width="12" height="12" style="transition-property: color, background-color, border-color, text-decoration-color, fill, stroke; transition-timing-function: cubic-bezier(0.17, 0.73, 0.14, 1); transition-duration: 100ms; color: rgb(140, 158, 178);"><path fill="hsl(211, 20%, 62.4%)" fill-rule="evenodd" clip-rule="evenodd" d="M4.4 9.493C4.14 10.28 4 11.124 4 12a8 8 0 1 0 10.899-7.459l-.953 3.81a1 1 0 0 1-.726.727l-3.444.866-.772 1.533a1 1 0 0 1-1.493.35L4.4 9.493Zm.883-1.84L7.756 9.51l.44-.874a1 1 0 0 1 .649-.52l3.306-.832.807-3.227a7.993 7.993 0 0 0-7.676 3.597ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm8.43.162a1 1 0 0 1 .77-.29l1.89.121a1 1 0 0 1 .494.168l2.869 1.928a1 1 0 0 1 .336 1.277l-.973 1.946a1 1 0 0 1-.894.553h-2.92a1 1 0 0 1-.831-.445L9.225 14.5a1 1 0 0 1 .126-1.262l1.08-1.076Zm.915 1.913.177-.177 1.171.074 1.914 1.286-.303.607h-1.766l-1.194-1.79Z"></path></svg>
                    <span>@(new Uri(Post.Data.ExternalUrl).Host)</span>
                </div>
            </div>
        </a>
    }

    @if (Post.Data?.Media != null)
    {
        <div class="post-image-list post-indented @(Post.Data.Media.Length > 1 ? "post-image-list-compact" : null)">

            @foreach (var image in Post.Data.Media)
            {
                @if (image.IsVideo)
                {
                    <a href="@Post.BlueskyUrl" title="@image.AltText" class="post-image-link blue-link" target="_blank" rel="noreferrer">
                        View video on bsky.app
                    </a>
                }
                else
                {
                    <a href="@Program.GetImageFullUrl(Post.Author.Did, image.Cid)" title="@image.AltText" class="post-image-link" target="_blank" rel="noreferrer">
                        <img src="@Program.GetImageThumbnailUrl(Post.Author.Did, image.Cid)" class="post-image">
                    </a>
                }
            }
        </div>
    }


    @if (Post.QuotedPost != null)
    {
        <ul class="post-quoted post-indented">
            <PostRow Post="Post.QuotedPost" IsQuote="true" />
        </ul>

    }

    <div class="post-status-bar post-indented">
        @if(Post.ReplyCount != 0){
            <a href="@Post.BaseUrl" title="Show replies">@Post.ReplyCount üí¨</a>
        }
        @if (Post.QuoteCount != 0)
        {
            <a href="@Post.BaseUrl/quotes" title="Show quotes">@Post.QuoteCount üí≠</a>
        }
        @if (Post.RepostCount != 0)
        {
            <a href="@Post.BaseUrl/reposts" title="Show reposts">@Post.RepostCount üîÅ</a>
        }
        @if (Post.LikeCount != 0)
        {
            <a href="@Post.BaseUrl/likes" title="Show likes">@Post.LikeCount ‚ô•</a>
        }

        <a class="bsky-link" target="_blank" href="@Post.BlueskyUrl" title="View on bsky.app"><img src="/assets/bluesky.png"></a>

    </div>
</li>

@if (IsLastOfGroup)
{
    <div class="post-group-separator"></div>    
}
